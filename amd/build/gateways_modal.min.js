define(["exports","core/ajax","core/templates","core/modal","core/modal_events","core/str","core/notification"],function(e,t,r,n,o,a,s){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=i(t),l=i(r),d=i(n),u=i(o),m=i(s);const p=e=>{const t="sandbox"===e?"https://jstest.authorize.net/v3/AcceptUI.js":"https://js.authorize.net/v3/AcceptUI.js";if(p.currentlyloaded===t)return Promise.resolve();if(p.currentlyloaded){const e=document.querySelector(`script[src="${p.currentlyloaded}"]`);e&&e.parentNode.removeChild(e)}const r=document.createElement("script");return new Promise(e=>{r.readyState?r.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e())}:r.onload=function(){e()},r.setAttribute("src",t),r.setAttribute("charset","utf-8"),document.head.appendChild(r),p.currentlyloaded=t})};p.currentlyloaded="",e.process=(e,t,r,n)=>{let o;return((e,t,r)=>c.default.call([{methodname:"paygw_authorizedotnet_get_config_for_js",args:{component:e,paymentarea:t,itemid:r}}])[0])(e,t,r).then(async e=>{const t=await l.default.render("paygw_authorizedotnet/authorizedotnet_button",{apiloginid:e.apiloginid,clientkey:e.publicclientkey});return Promise.all([d.default.create({title:a.getString("pluginname","paygw_authorizedotnet"),body:t,show:!0,removeOnClose:!0}),p(e.environment)])}).then(([n])=>(o=n,new Promise(n=>{window.responseHandler=function(s){if(o.getRoot().on(u.default.outsideClick,e=>{e.preventDefault()}),"Error"===s.messages.resultCode){let e="";for(let t=0;t<s.messages.message.length;t++)e+=s.messages.message[t].text+"\n";return void m.default.alert(a.getString("error","moodle"),e)}o.setBody(a.getString("authorising","paygw_authorizedotnet")),((e,t,r,n)=>c.default.call([{methodname:"paygw_authorizedotnet_process_payment",args:{component:e,paymentarea:t,itemid:r,opaquedata:JSON.stringify(n)}}])[0])(e,t,r,s.opaqueData).then(e=>(o.hide(),e)).then(n)}}))).then(e=>e.success?Promise.resolve(e.message):Promise.reject(e.message))},Object.defineProperty(e,"__esModule",{value:!0})});
